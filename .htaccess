# Force HTTPS
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteCond %{HTTP:X-Forwarded-Proto} =http
    RewriteRule ^(.*)$ https://%{HTTP_HOST}/$1 [R=301,L]

    # Clean URLs - /search/username -> clip_search.php?login=username
    RewriteRule ^search/([a-zA-Z0-9_]+)/?$ clip_search.php?login=$1 [QSA,L]

    # Clean URLs - /dashboard/username -> dashboard.php?login=username
    RewriteRule ^dashboard/([a-zA-Z0-9_]+)/?$ dashboard.php?login=$1 [QSA,L]

    # Clean URLs - /mod/username -> mod_dashboard.php?login=username
    RewriteRule ^mod/([a-zA-Z0-9_]+)/?$ mod_dashboard.php?login=$1 [QSA,L]

    # Clean URLs - /manage/username -> clip_manage.php?login=username
    RewriteRule ^manage/([a-zA-Z0-9_]+)/?$ clip_manage.php?login=$1 [QSA,L]

    # Clean URLs - /channels -> my_channels.php (dashboard hub)
    RewriteRule ^channels/?$ my_channels.php [QSA,L]

    # Clean URLs - /archive -> archive.php (self-service archive)
    RewriteRule ^archive/?$ archive.php [QSA,L]

    # Clean URLs - /invite/username -> invite.php (streamer onboarding)
    RewriteRule ^invite/([a-zA-Z0-9_]+)/?$ invite.php?login=$1 [QSA,L]
    RewriteRule ^invite/?$ invite.php [QSA,L]
</IfModule>

# Enable CORS for all origins and security headers
<IfModule mod_headers.c>
    Header set Access-Control-Allow-Origin "*"
    Header set Access-Control-Allow-Methods "GET, POST, OPTIONS"
    Header set Access-Control-Allow-Headers "Content-Type"
    # Force HTTPS and prevent downgrade attacks
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
    # Upgrade any HTTP resources to HTTPS
    Header always set Content-Security-Policy "upgrade-insecure-requests"
</IfModule>

# Set proper MIME types
<IfModule mod_mime.c>
    AddType application/json .json
    AddType text/plain .txt
</IfModule>
